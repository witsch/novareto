<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">
  <head>
    <metal:block metal:fill-slot="head_slot">
      <script>

      </script>
    </metal:block>
  </head>
  <body>
    <metal:main fill-slot="main" 
		tal:define="portal context/@@plone_portal_state/portal;">
      <h1 class="documentFirstHeading" tal:content="context/Title" />
      <div tal:condition="not: view/overflow">
	<h2>Rendering events for <span tal:content="view/current_year" /></h2>
	<p>
	  <a href=""
	     tal:condition="view/previous_year"
	     tal:attributes="href string:${context/absolute_url}/?year=${view/previous_year}">&larr; <span i18n:translate="label_previous">previous</span></a>
	  <tal:sep condition="python: view.next_year and view.previous_year">
	    &bull;
	  </tal:sep>
	  <a href=""
	     tal:condition="view/next_year"
	     tal:attributes="href string:${context/absolute_url}/?year=${view/next_year}"><span i18n:translate="label_next">next</span> &rarr;</a>
	</p>

	<tal:events tal:repeat="month python:sorted(view.events.keys())"
		    tal:define="toLocalizedTime nocall: context/@@plone/toLocalizedTime;">

	  <h3 i18n:translate=""
        i18n:domain="plonelocales"
        tal:condition="python: view.events[month]"
	      tal:content="python: 'month_%s' % view.get_month_name(month).lower()[:3]" />

	  <metal:block tal:repeat="event python:view.events[month]">

	  <div class="newsItem"
	       metal:define-macro="listitem"
	       tal:define="result python:event[1];
			   status python:event[0];
			   resultObject result/getObject;
			   creator result/Creator;
			   resulturl resultObject/absolute_url;">
      <h4>
        <a href="/view"
           tal:condition="python: status == 'current'"
           tal:attributes="href resulturl"
           tal:content="string: heute: ${result/pretty_title_or_id}">
           Event headline
        </a>
        <a href="/view"
           tal:condition="python: status != 'current'"
           tal:attributes="href resulturl"
           tal:content="python:toLocalizedTime(resultObject.start()) + ': ' + result.Title">
           Event headline
         </a>
         <span class="discreet">( 
        <a class="discreet" href="#"
          tal:attributes="href string:$resulturl/ics_view"
          title="Download this event in iCal format"
          i18n:attributes="title title_add_to_ical;">
           <img tal:replace="structure portal/icon_export_ical.png"
           src="" alt="" />
           <span i18n:translate="label_add_to_ical">iCal</span>
       </a>)</span>
      </h4>

    <div class="newsDescription">
      <p tal:content="result/Description">
        Description
      </p>  
    </div>              

    <div class="newsContent">
      <ul class="newsAbout">
        <li tal:define="subject resultObject/Subject"
            tal:condition="subject">
            <span i18n:translate="">what: </span>
			      <span tal:content="python:modules['string'].join(subject, ' ')">Conference</span>
        </li>
        <li tal:condition="result/location">
          <span i18n:translate="">where: </span><span tal:content="result/location" />
        </li>
        <li>
          <span i18n:translate="">when: </span>
			    <span tal:replace="python:toLocalizedTime(resultObject.start(), long_format=1)">Start Date Time</span>
			    <span i18n:translate="event_and">to</span>
			    <span tal:replace="python:toLocalizedTime(resultObject.end(), long_format=1)">End Date Time</span>.
        </li>
      </ul>
		    
                </div>
            </div>
        </metal:block>
	</tal:events>

      </div>
      <div tal:condition="view/overflow">
	You're too far in the future or in the past.
	Please use the provided links to access the events.
	<a href="" tal:attributes="href string:${context/absolute_url}"
	   >Return to the index</a>.
      </div>
    </metal:main>
  </body>
</html>
